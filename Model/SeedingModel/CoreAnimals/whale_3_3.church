(define categories (list 'eagle 'whale 'horse 'lion 'elephant 'man))
(define (categories-prior) (multinomial categories '(0.002 0.002 0.002 0.002 0.002 0.99)))
(define utterances categories)
(define costs '(1 1 1 1 1 1))
(define (utterance-prior) (multinomial utterances (map (lambda (utterance-cost) (exp (- utterance-cost))) costs)))
(define hard (list 0 1 2))
(define (hard-prior category)
(case category
	(('eagle) (multinomial hard (list 0.714285714285714 0.238095238095238 0.0476190476190476)))
	(('whale) (multinomial hard (list 0.333333333333333 0.523809523809524 0.142857142857143)))
	(('horse) (multinomial hard (list 0.571428571428571 0.285714285714286 0.142857142857143)))
	(('lion) (multinomial hard (list 0.80952380952381 0.0952380952380952 0.0952380952380952)))
	(('elephant) (multinomial hard (list 0.333333333333333 0.333333333333333 0.333333333333333)))
	(('man) (multinomial hard (list 0.571428571428571 0.333333333333333 0.0952380952380952)))
))
(define big (list 0 1 2))
(define (big-prior category)
(case category
	(('eagle) (multinomial big (list 0.642857142857143 0.285714285714286 0.0714285714285714)))
	(('whale) (multinomial big (list 0.0714285714285714 0.142857142857143 0.785714285714286)))
	(('horse) (multinomial big (list 0.0714285714285714 0.714285714285714 0.214285714285714)))
	(('lion) (multinomial big (list 0.285714285714286 0.428571428571429 0.285714285714286)))
	(('elephant) (multinomial big (list 0.0714285714285714 0.0714285714285714 0.857142857142857)))
	(('man) (multinomial big (list 0.285714285714286 0.642857142857143 0.0714285714285714)))
))
(define proud (list 0 1 2))
(define (proud-prior category)
(case category
	(('eagle) (multinomial proud (list 0.166666666666667 0.166666666666667 0.666666666666667)))
	(('whale) (multinomial proud (list 0.375 0.416666666666667 0.208333333333333)))
	(('horse) (multinomial proud (list 0.25 0.291666666666667 0.458333333333333)))
	(('lion) (multinomial proud (list 0.125 0.0833333333333333 0.791666666666667)))
	(('elephant) (multinomial proud (list 0.333333333333333 0.291666666666667 0.375)))
	(('man) (multinomial proud (list 0.0416666666666667 0.125 0.833333333333333)))
))
(define fast (list 0 1 2))
(define (fast-prior category)
(case category
	(('eagle) (multinomial fast (list 0.1875 0.375 0.4375)))
	(('whale) (multinomial fast (list 0.5 0.3125 0.1875)))
	(('horse) (multinomial fast (list 0.125 0.4375 0.4375)))
	(('lion) (multinomial fast (list 0.0625 0.6875 0.25)))
	(('elephant) (multinomial fast (list 0.5625 0.3125 0.125)))
	(('man) (multinomial fast (list 0.375 0.3125 0.3125)))
))
(define fierce (list 0 1 2))
(define (fierce-prior category)
(case category
	(('eagle) (multinomial fierce (list 0.4375 0.25 0.3125)))
	(('whale) (multinomial fierce (list 0.625 0.25 0.125)))
	(('horse) (multinomial fierce (list 0.6875 0.25 0.0625)))
	(('lion) (multinomial fierce (list 0.0625 0.1875 0.75)))
	(('elephant) (multinomial fierce (list 0.5 0.3125 0.1875)))
	(('man) (multinomial fierce (list 0.25 0.375 0.375)))
))
(define majestic (list 0 1 2))
(define (majestic-prior category)
(case category
	(('eagle) (multinomial majestic (list 0.176470588235294 0.352941176470588 0.470588235294118)))
	(('whale) (multinomial majestic (list 0.117647058823529 0.411764705882353 0.470588235294118)))
	(('horse) (multinomial majestic (list 0.117647058823529 0.411764705882353 0.470588235294118)))
	(('lion) (multinomial majestic (list 0.117647058823529 0.176470588235294 0.705882352941177)))
	(('elephant) (multinomial majestic (list 0.0588235294117647 0.294117647058824 0.647058823529412)))
	(('man) (multinomial majestic (list 0.411764705882353 0.294117647058824 0.294117647058824)))
))
(define strong (list 0 1 2))
(define (strong-prior category)
(case category
	(('eagle) (multinomial strong (list 0.555555555555556 0.333333333333333 0.111111111111111)))
	(('whale) (multinomial strong (list 0.111111111111111 0.222222222222222 0.666666666666667)))
	(('horse) (multinomial strong (list 0.166666666666667 0.444444444444444 0.388888888888889)))
	(('lion) (multinomial strong (list 0.166666666666667 0.388888888888889 0.444444444444444)))
	(('elephant) (multinomial strong (list 0.111111111111111 0.222222222222222 0.666666666666667)))
	(('man) (multinomial strong (list 0.333333333333333 0.444444444444444 0.222222222222222)))
))
(define goals (list 'category? 'hard? 'big? 'proud? 'fast? 'fierce? 'majestic? 'strong?))
(define (goal-prior) (uniform-draw goals))
(define lit-listener (mem (lambda (utterance goal)
(enumeration-query
(define category utterance)
(define feature
	(case goal
		(('category?) category)
		(('hard?) (hard-prior category))
		(('big?) (big-prior category))
		(('proud?) (proud-prior category))
		(('fast?) (fast-prior category))
		(('fierce?) (fierce-prior category))
		(('majestic?) (majestic-prior category))
		(('strong?) (strong-prior category))
))
feature
#t))))
(define speaker (mem (lambda 
(category hard big proud fast fierce majestic strong goal)
(enumeration-query
(define utterance (utterance-prior))
(define dimension
	(case goal
		(('category?) category)
		(('hard?) hard)
		(('big?) big)
		(('proud?) proud)
		(('fast?) fast)
		(('fierce?) fierce)
		(('majestic?) majestic)
		(('strong?) strong)
))
utterance
(equal? (apply multinomial (lit-listener utterance goal)) dimension)))))
(define listener (mem (lambda (utterance)
(enumeration-query
(define category (categories-prior))
(define hard (hard-prior category))
(define big (big-prior category))
(define proud (proud-prior category))
(define fast (fast-prior category))
(define fierce (fierce-prior category))
(define majestic (majestic-prior category))
(define strong (strong-prior category))
(define speaker-goal (goal-prior))
(list category hard big proud fast fierce majestic strong)
(equal? utterance (apply multinomial (raise-to-power (speaker category hard big proud fast fierce majestic strong speaker-goal) alpha)))))))
(define (raise-to-power speaker-dist alpha) (list (first speaker-dist) (map (lambda (x) (pow x alpha)) (second speaker-dist))))
(define alpha 3)
(define interpretation (listener 'whale))
(write-csv (map flatten (zip (first interpretation) (second interpretation))) '/Users/justinek/Dropbox/Work/Grad_school/Research/Metaphor/metaphors/Model/SeedingModel/CoreAnimalsOutput/whale_3_3.csv)